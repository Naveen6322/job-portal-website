{% extends "base.html" %}

{% block content %}

<h2>Available Jobs</h2>

<p class="text-muted">
    {{ page_obj.paginator.count }} job(s) found
</p>

<p>
    Welcome, {{ request.user.email }} |
    <a href="{% url 'jobs:my_applications' %}">ðŸ“„ My Applications</a> |
    <a href="{% url 'logout' %}">Logout</a>
</p>

<hr>

<form method="get" class="mb-4">
  <form method="POST" enctype="multipart/form-data">
    <div class="input-group">
        <input type="text"
               name="q"
               class="form-control"
               placeholder="Search jobs..."
               value="{{ query|default:'' }}">
        <button class="btn btn-dark">Search</button>
    </div>
</form>

<p>Total jobs: {{ page_obj.paginator.count }}</p>

{% for job in page_obj %}
    <div style="border:1px solid #ccc; padding:15px; margin-bottom:15px;">
        <h3>{{ job.title }}</h3>
        <p>{{ job.description }}</p>

        {% if job.id in applied_jobs %}
            <p><strong>âœ… Already Applied</strong></p>
        {% else %}
            <form method="POST"
               enctype="multipart/form-data"
              action="{% url 'jobs:apply_job' job.id %}">
              {% csrf_token %}

                <input type="file" name="resume" required>
                <button type="submit">Apply</button>
</form>
        {% endif %}
    </div>
{% empty %}
    <p>No jobs available.</p>
{% endfor %}

<nav>
    <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">
                    Previous
                </a>
            </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}">
                    Next
                </a>
            </li>
        {% endif %}

    </ul>
</nav>

{% endblock %}
